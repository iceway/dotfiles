" vim: set expandtab tabstop=4 shiftwidth=4:

" @@@ VIM é…ç½®ï¼ˆç»ˆç«¯ç¯å¢ƒï¼‰ @@@
" Author: Iceway Zhang
" Updated: 2021/06/08


"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" å¤‡ç”¨é€‰é¡¹ï¼Œæ ¹æ®éœ€è¦è‡ªè¡Œå¼€å¯
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

" set relativenumber                 " æ˜¾ç¤ºç›¸å¯¹ï¼ˆå½“å‰å…‰æ ‡æ‰€åœ¨è¡Œï¼‰è¡Œå·è€Œä¸æ˜¯ç»å¯¹è¡Œå·
" set ignorecase                     " æœç´¢æ—¶å¤§å°å†™ä¸æ•æ„Ÿ
" set nowrap                         " é•¿åº¦è¶…è¿‡çª—å£å®½åº¦ä¸è¦æ¢è¡Œæ˜¾ç¤º
" set list                           " è®©VIMæ˜¾ç¤ºç©ºæ ¼ã€tabã€æ¢è¡Œç­‰ä¸å¯è§å­—ç¬¦
" set listchars=nbsp:Â¬,trail:Â·,tab:Â» " è®¾ç½®VIMæŠŠç©ºæ ¼ã€æ¢è¡Œã€tabæ˜¾ç¤ºä¸ºæŒ‡å®šå­—ç¬¦
" set shiftwidth=4                   " è®¾å®šVIMçš„è‡ªåŠ¨ç¼©è¿›ï¼Œä»¥åŠ>å’Œ<å‘½ä»¤æ—¶ç§»åŠ¨çš„ç©ºç™½é•¿åº¦
" set softtabstop=4                  " æŒ‰ä¸‹tabæ—¶ï¼Œæ’å…¥çš„æ˜¯ç©ºæ ¼å’Œtabåˆ¶è¡¨ç¬¦çš„æ··åˆ
" set tabstop=4                      " è®¾å®štabé•¿åº¦ä¸º4å­—èŠ‚
" set expandtab                      " é”®å…¥tabæ—¶ï¼Œè‡ªåŠ¨ç”¨ç©ºæ ¼æ›¿æ¢tabï¼Œç©ºæ ¼é•¿åº¦ç­‰äºtabstopçš„è®¾ç½®
" set showmode                       " è®©VIMåœ¨çª—å£æœ€ä½ä¸‹æ˜¾ç¤ºå½“å‰æ¨¡å¼ï¼Œå¦‚--INSERT--ç­‰
" set autochdir                      " è‡ªåŠ¨åˆ‡æ¢å½“å‰å·¥ä½œè·¯å¾„ã€‚


"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" è®¾ç½®vimåŸºç¡€é€‰é¡¹
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

set nocompatible                " ä¸ä½¿ç”¨viå…¼å®¹æ¨¡å¼
set encoding=utf-8              " é»˜è®¤ä½¿ç”¨utf-8ç¼–ç 
set ruler                       " æ˜¾ç¤ºçŠ¶æ€æ å…‰æ ‡æ ‡å°º
set cursorline                  " çªå‡ºæ˜¾ç¤ºå½“å‰è¡Œï¼ˆé«˜äº®å½“å‰è¡Œï¼‰
set number                      " æ˜¾ç¤ºè¡Œå·
set colorcolumn=100             " åœ¨çª—å£100å­—ç¬¦å®½å¤„æ˜¾ç¤ºä¸€ä¸ªç«–çº¿æç¤ºæ–‡æœ¬çš„æ¨èå®½åº¦ã€‚
set hlsearch                    " é«˜äº®æœç´¢ç»“æœ
set incsearch                   " è¾“å…¥æœç´¢å†…å®¹æ—¶å°±åŒæ­¥æ˜¾ç¤ºæœç´¢ç»“æœ
set scrolloff=3                 " å…‰æ ‡ç§»åŠ¨åˆ°é¡¶éƒ¨å’Œåº•éƒ¨æ—¶è‡ªåŠ¨ä¿æŒ3è¡Œè·ç¦»
set showmatch                   " æ˜¾ç¤ºè‡ªåŠ¨åŒ¹é…åˆ°çš„å¯¹åº”æ‹¬å·
set showcmd                     " åœ¨å‘½ä»¤æ¨¡å¼ä¸‹è¾“å…¥å‘½ä»¤æ—¶ï¼ŒåŒæ­¥æ˜¾ç¤ºå·²ç»é”®å…¥çš„å‘½ä»¤å†…å®¹
set nobackup                    " ä¿å­˜æ–‡ä»¶æ—¶ï¼Œä¸è¦è‡ªåŠ¨åˆ›å»ºå¤‡ä»½æ–‡ä»¶
set textwidth=0                 " ä¸€è¡Œå†…è¾“å…¥å­—ç¬¦è¾¾åˆ°å¤šå°‘æ—¶è‡ªåŠ¨æ¢è¡Œï¼Œ0è¡¨ç¤ºä¸é™åˆ¶
set history=500                 " è®°å½•çš„å†å²å‘½ä»¤ä¸ªæ•°
set backspace=indent,eol,start  " é€€æ ¼é”®ï¼ˆbackspaceï¼‰é»˜è®¤å·¥ä½œåœ¨viæ¨¡å¼ä¸‹ã€‚è¯¥è®¾ç½®ä¿®æ”¹é€€æ ¼é”®çš„æ¨¡å¼ã€‚
                                " indent: å¦‚æœè®¾ç½®äº†:set indentç­‰è‡ªåŠ¨ç¼©è¿›ï¼ŒæŒ‰é€€æ ¼é”®ä¼šåˆ æ‰è¿™ä¸ªç¼©è¿›ã€‚
                                " eol: å¦‚æœæ’å…¥æ¨¡å¼ä¸‹åœ¨è¡Œå¼€å¤´ï¼Œè®¾ç½®äº†eolåæŒ‰ä¸‹é€€æ ¼é”®ä¼šåˆå¹¶åˆ°ä¸Šä¸€è¡Œã€‚
                                " start: è‹¥ä¸è®¾ç½®ä¸ºstartï¼Œåˆ™åœ¨å›é€€æ—¶ï¼Œåªèƒ½å›é€€åˆ é™¤è‡ªå·±æ–°æ·»åŠ çš„å­—ç¬¦ï¼Œ
                                " åŸæ¥å·²ç»å­˜åœ¨çš„å­—ç¬¦æ— æ³•å›é€€åˆ é™¤ã€‚
set pastetoggle=<F3>            " æŒ‰ä¸‹F3é”®å¯ä»¥åˆ‡æ¢ç²˜è´´æ’å…¥æ¨¡å¼[Insert (paste)]å’Œæ™®é€šæ’å…¥æ¨¡å¼ã€‚
set viminfo='100,f1,<500        " è¯¦è§ï¼šhttps://vimjc.com/viminfo.html
set tags=./tags;,tags           " æŸ¥æ‰¾ctagsæ ‡ç­¾æ–‡ä»¶æ—¶ï¼Œä»å½“å‰ç›®å½•ä¸€ç›´å¾€ä¸ŠæŸ¥æ‰¾ã€‚
set foldmethod=indent           " è®¾ç½®æŠ˜å : manual, syntax, indent, diff
set nofoldenable                " é»˜è®¤ä¸è¦å¼€å¯æŠ˜å 


"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" è®¾ç½®vimå˜é‡
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

let mapleader = "\\" " è®¾ç½®åæ–œçº¿ä½œä¸º<leader>é”®


"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" è®¾ç½®vimæŒ‰é”®æ˜ å°„
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

" ç©ºæ ¼æ˜ å°„åˆ°æ‰“å¼€/å…³é—­æŠ˜å ã€‚
nnoremap <space> za

" æ˜ å°„å‘½ä»¤ï¼šè¾“å…¥`<leader>W`å‘½ä»¤æ—¶ä»¥sudoæƒé™ä¿å­˜æ–‡ä»¶ã€‚
nnoremap <leader>W :w !sudo tee >/dev/null %<CR>
" æ˜ å°„å‘½ä»¤ï¼šæ‰“å¼€ä¸€ä¸ªæ–°çš„çºµå‘åˆ†å±ç¼–è¾‘vimrcé…ç½®æ–‡ä»¶ã€‚
nnoremap <leader>ev :vsplit $MYVIMRC<CR>
" æ˜ å°„å‘½ä»¤ï¼šé‡æ–°åŠ è½½vimrcé…ç½®æ–‡ä»¶ã€‚
nnoremap <leader>sv :source $MYVIMRC<CR>

" ctags/cscopeé…ç½®ï¼Œéœ€è¦ç³»ç»Ÿå®‰è£…äº†ctagsï¼Œcscopeè½¯ä»¶ã€‚
if has("cscope")
    set csprg=/usr/bin/cscope
    set csto=1
    set cst
    set nocsverb
    if filereadable("cscope.out")
        cs add cscope.out
    endif
    set csverb
endif
nnoremap <F6> :!ctags -R<CR>:!cscope -Rbq<CR>:cs add cscope.out<CR>:cs reset <CR><CR>
nnoremap <C-@>s :cs find s <C-R>=expand("<cword>")<CR><CR>
nnoremap <C-@>g :cs find g <C-R>=expand("<cword>")<CR><CR>
nnoremap <C-@>d :cs find d <C-R>=expand("<cword>")<CR><CR>
nnoremap <C-@>c :cs find c <C-R>=expand("<cword>")<CR><CR>
nnoremap <C-@>i :cs find i ^<C-R>=expand("<cfile>")<CR>$<CR>
nnoremap <C-@>e :cs find e <C-R>=expand("<cword>")<CR><CR>
nnoremap <F7> :Autoformat<CR>


"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" è®¾ç½®vimè‡ªåŠ¨æ‰§è¡Œå‘½ä»¤
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

" ä¸é‡å¯VIMï¼Œè®©é…ç½®æ–‡ä»¶ä¿å­˜åç«‹å³ç”Ÿæ•ˆ
autocmd BufWritePost $MYVIMRC source $MYVIMRC

" æ‰“å¼€æ–‡ä»¶åï¼Œè‡ªåŠ¨è·³è½¬åˆ°ä¸Šä¸€æ¬¡é€€å‡ºæ—¶æ‰€åœ¨è¡Œ
autocmd BufReadPost *
            \ if line("'\"") > 1 && line("'\"") <= line("$") |
            \   exe "normal! g'\"" |
            \ endif

" è®¾ç½®ç‰¹å®šç±»å‹æ–‡ä»¶çš„ç¼©è¿›å’Œå¯¹é½
"autocmd FileType python,php,ruby,go,sh,bash,conf,nginx setlocal et sta sw=4 sts=4
"autocmd FileType json,html,javascript,html,yml setlocal et sta sw=2 sts=2

" æ‰“å¼€åç¼€åä¸ºmdçš„æ–‡ä»¶ï¼Œå°†æ–‡ä»¶ç±»å‹è®¾ç½®ä¸ºmarkdown
autocmd BufNewFile,BufReadPost *.md set filetype=markdown
autocmd BufNewFile,BufReadPost *.h set filetype=c

" å¯ç”¨VIMå†…ç½®çš„man page reviewerï¼Œå¯ä»¥ç”¨å‘½ä»¤`:Man XXX`æŸ¥çœ‹æ‰‹å†Œé¡µ
runtime! ftplugin/man.vim


"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" VIMæ’ä»¶è¯¦ç»†é…ç½®
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

" é…è‰²æ–¹æ¡ˆé…ç½®(å¦‚æœç»ˆç«¯ä¸æ”¯æŒæ–œä½“å­—æ˜¾ç¤ºï¼Œå°†ä¸‹é¢ä¸¤è¡Œæ³¨é‡Š)
let g:monokai_term_italic = 1
let g:gruvbox_italic = 1

" vim-airlineé…ç½®
set laststatus=2
let g:airline_theme='simple'
let g:airline#extensions#tabline#enabled = 1

" ultisnipsé…ç½®
let g:UltiSnipsExpandTrigger = "<C-j>"
let g:UltiSnipsJumpForwardTrigger = "<C-j>"
let g:UltiSnipsJumpBackwardTrigger = "<C-k>"

" YouCompleteMeé…ç½®
let g:ycm_global_ycm_extra_conf = '~/.ycm_extra_conf.py'
let g:ycm_use_clangd = 1
let g:ycm_clangd_binary_path = "~/.vim/plugs/YouCompleteMe/third_party/ycmd/third_party/clangd/output/bin/clangd"
let g:ycm_show_diagnostics_ui = 0
let g:ycm_confirm_extra_conf = 0
let g:ycm_collect_identifier_from_comments_and_strings = 0
let g:ycm_complete_in_strings = 1
let g:ycm_complete_in_comments = 1
set completeopt=menu,menuone
let g:ycm_semantic_triggers = {
            \ 'c,cpp,python,java,go': ['re!\w{2}'],
            \ 'cs,lua,javascript,sh': ['re!\w{2}']
            \ }
let g:ycm_filetype_whitelist = {
            \ "c":1, "cpp":1, "h":1, "sh":1, "zsh":1,
            \ "python":1, "vim":1, "go":1, "javascript":1, "lua":1
            \ }

" aleé…ç½®
let g:ale_sign_error = 'âœ—'
let g:ale_sign_warning = 'âš '
let g:ale_linters_explicit = 1
let g:ale_linters = {
            \   'sh': ['shellcheck'],
            \   'csh': ['shell'],
            \   'zsh': ['shell'],
            \   'go': ['gofmt', 'golint'],
            \   'python': ['flake8', 'mypy', 'pylint'],
            \   'c': ['gcc', 'cppcheck'],
            \   'cpp': ['gcc', 'cppcheck'],
            \   'text': [],
            \}
let g:ale_completion_delay = 500
let g:ale_echo_delay = 20
let g:ale_lint_delay = 500
let g:ale_echo_msg_format = '[%linter%] %code: %%s'
let g:ale_lint_on_text_changed = 'never'
let g:ale_lint_on_insert_leave = 0
let g:ale_lint_on_enter = 0
let g:ale_set_loclist = 0
let g:ale_set_quickfix = 1
let g:ale_open_list = 1
let g:ale_c_cc_options = '-Wall -O2 -std=c99'
let g:ale_cpp_cc_options = '-Wall -O2 -std=c++11'
let g:ale_c_gcc_options = '-Wall -O2 -std=c99'
let g:ale_cpp_gcc_options = '-Wall -O2 -std=c++11'
let g:ale_c_cppcheck_options = ''
let g:ale_cpp_cppcheck_options = ''
let g:ale_c_parse_makefile = 1
nmap <silent> <C-k> <Plug>(ale_previous_wrap)
nmap <silent> <C-j> <Plug>(ale_next_wrap)

" vim-autoformateré…ç½®ï¼Œé’ˆå¯¹Cè¯­è¨€éœ€è¦ç³»ç»Ÿå®‰è£…äº†astyle
"let g:autoformat_autoindent = 0
"let g:autoformat_retab = 0
"let g:autoformat_remove_trailing_spaces = 0
let g:autoformat_verbosemode=1
let g:formatdef_astyle = '"astyle -A8 -s4 -xC100 -p -k3 -W3 -j"'
let g:formatters_cpp = ['astyle']
let g:formatters_c = ['astyle']
let g:formatdef_shfmt = '"shfmt -bn -fn"'
let g:formatters_sh = ['shfmt']
let g:formatdef_black = '"black -q -l 100 -"'
let g:formatters_python = ['black']

" indentLineé…ç½®
let g:indentLine_char='â”†'
let g:indentLine_enabled = 1
let g:indentLine_color_term = 239

" vim-markdowné…ç½®
" let g:vim_markdown_folding_disabled = 1
let g:vim_markdown_conceal = 0
let g:vim_markdown_conceal_code_blocks = 0

" vim-polygloté…ç½®
let g:polyglot_disabled = ['autoindent']
let g:polyglot_disabled = ["sensible"]

" the-nerd-treeé…ç½®
nmap <F2> :NERDTreeToggle<CR>


"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" VIMæ’ä»¶ï¼šä½¿ç”¨vim-plug ç®¡ç†æ’ä»¶
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

" å¯åŠ¨vimæ—¶åˆ¤æ–­vim-plugæ’ä»¶ç®¡ç†å™¨æ˜¯å¦å·²å®‰è£…ï¼Œå¦‚æ²¡æœ‰åˆ™é€šè¿‡curlä¸‹è½½vim-plugã€‚
let iCanHazPlug=1
let plug_file=expand('~/.vim/autoload/plug.vim')
if !filereadable(plug_file)
    echo "Installing vim-plug..."
    echo ""
    silent !mkdir -p ~/.vim/autoload/
    silent !curl -fLo ~/.vim/autoload/plug.vim --create-dirs
                \ https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
    let iCanHazPlug=0
endif

call plug#begin('~/.vim/plugs')

Plug 'crusoexia/vim-monokai'          " é…è‰²æ–¹æ¡ˆmonokai
Plug 'morhetz/gruvbox'                " é…è‰²æ–¹æ¡ˆgruvbox
Plug 'vim-airline/vim-airline'        " çŠ¶æ€æ æ ·å¼å’Œé…è‰²
Plug 'vim-airline/vim-airline-themes' " æä¾›å¤§é‡vim-airlineé…è‰²æ–¹æ¡ˆ
Plug 'SirVer/ultisnips'               " ä»£ç å—è¡¥å…¨å¼•æ“
Plug 'honza/vim-snippets'             " æä¾›å¤§é‡é€‚ç”¨äºultisnipsçš„ä»£ç å—
Plug 'Valloric/YouCompleteMe'         " åŸºäºè¯­ä¹‰çš„ä»£ç è‡ªåŠ¨è¡¥å…¨
Plug 'dense-analysis/ale'             " å„æ–‡ä»¶ç±»å‹çš„è¯­æ³•å®æ—¶æ£€æŸ¥
Plug 'Chiel92/vim-autoformat'         " è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç 
Plug 'easymotion/vim-easymotion'      " å¿«é€Ÿç§»åŠ¨
Plug 'tpope/vim-fugitive'             " gité›†æˆæ’ä»¶
Plug 'lilydjwg/colorizer'             " é¢œè‰²ä»£ç å€¼ï¼ˆ#XXXXXXï¼‰ç›´æ¥æ˜¾ç¤ºè‰²å½©
Plug 'sheerun/vim-polyglot'           " æ”¯æŒå¤§å¤šæ•°è¯­è¨€çš„è¯­æ³•é«˜äº®æ’ä»¶
Plug 'guns/xterm-color-table.vim'     " æŸ¥çœ‹ç»ˆç«¯256è‰²ï¼Œå‘½ä»¤:XtermColorTable
Plug 'Yggdroot/indentLine'            " æ˜¾ç¤ºä¸åŒçº§åˆ«çš„ç¼©è¿›
Plug 'tell-k/vim-autopep8'            " åŸºäºPEP8æ ¼å¼åŒ–pythonä»£ç ï¼Œå‘½ä»¤:Autopep8
Plug 'godlygeek/tabular'              " æŒ‰ç…§æŒ‡å®šçš„ç¬¦å·å¯¹é½ï¼ˆæ–¹ä¾¿æ•´ç†æ³¨é‡Šï¼‰
Plug 'plasticboy/vim-markdown'        " markdownæ’ä»¶
Plug 'scrooloose/nerdtree'            " æµè§ˆæ–‡ä»¶å¤¹ç›®å½•æ•°
Plug 'scrooloose/nerdcommenter'       " è‡ªåŠ¨æ³¨é‡Šæ’ä»¶
Plug 'ntpeters/vim-better-whitespace' " é«˜äº®ç©ºç™½
Plug 'dhruvasagar/vim-table-mode'     " vimå­—ç¬¦è¡¨æ ¼ï¼Œåˆ›å»º&æ ¼å¼åŒ–

" å®‰è£…äº†vim-plugåï¼Œé¦–æ¬¡è‡ªåŠ¨å®‰è£…æ’ä»¶
if iCanHazPlug == 0
    echo "Installing plugins, please ignore key map error messages"
    echo ""
    :PlugInstall
endif

" æ‰€æœ‰æ’ä»¶éœ€è¦åœ¨ä¸‹é¢è¿™è¡Œä¹‹å‰å¼•å…¥
call plug#end()


"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
" ä¸‹é¢çš„é€‰é¡¹å»ºè®®åœ¨æ’ä»¶ä¹‹å
"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

" å¼€å¯è¯­æ³•é«˜äº®æ˜¾ç¤º
syntax on

" å¯ç”¨true colorï¼ˆvim >= 7.4.1770)ï¼Œæˆ–è€…è®¾ç½®256colors
if has("termguicolors")
    set t_8f=[38;2;%lu;%lu;%lum
    set t_8b=[48;2;%lu;%lu;%lum

    set termguicolors " æ”¯æŒ24ä½çœŸè‰²å½©
elseif &term =~ "256color"
    set t_Co=256 " æ”¯æŒ256è‰²
endif

" è®¾ç½®è‰²å½©ç©ºé—´ä¸ºæš—è‰²è°ƒï¼Œä½¿ç”¨monokaié…è‰²æ–¹æ¡ˆ
colorscheme monokai
set background=dark

" è®¾ç½®å½“å‰è¡Œé«˜äº®ï¼ŒåŠ ç²—ï¼Œæ˜¾ç¤ºä¸‹åˆ’çº¿
set cursorline
hi CursorLine cterm=bold,underline

" è®¾ç½®PopWindowå‰æ™¯å’ŒèƒŒæ™¯è‰²
" hi Pmenu term=standout ctermfg=0 ctermbg=11 guifg=Black guibg=LightYellow
" hi PmenuSel term=bold,reverse cterm=bold ctermfg=0 ctermbg=121 gui=bold guifg=bg guibg=LightGreen
set listchars=tab:Â»â€¥
hi SpecialKey ctermfg=77 guifg=#654321
set list

" fix: redrawtime' exceeded, syntax highlighting disabled
" https://github.com/fatih/vim-go/issues/3171#issuecomment-804226692
set re=1
